{
  "version": 1,
  "data": {
    "source": "http",
    "url": "https://api.adsb.lol/v2/lat/{{geo.lat}}/lon/{{geo.lon}}/dist/40",
    "poll_ms": 30000,
    "debug": true,
    "transforms": [
      {
        "op": "map",
        "from": "ac",
        "to": "rows",
        "fields": {
          "flight": {
            "coalesce": ["flight", "callsign", "hex"],
            "default": "?"
          },
          "type": {
            "coalesce": ["t", "type"],
            "default": "?"
          },
          "dest": {
            "coalesce": ["destination", "route", "to"],
            "default": "?"
          },
          "alt_text": {
            "coalesce": ["alt_baro", "altitude"],
            "default": "?"
          },
          "lat": "lat",
          "lon": "lon",
          "dst": "dst"
        }
      },
      {
        "op": "compute_distance",
        "from": "rows",
        "to_field": "km",
        "prefer_nm_path": "dst",
        "lat_path": "lat",
        "lon_path": "lon",
        "origin_lat": "{{geo.lat}}",
        "origin_lon": "{{geo.lon}}"
      },
      {
        "op": "sort",
        "from": "rows",
        "by": "km",
        "numeric": true,
        "order": "asc"
      },
      {
        "op": "take",
        "from": "rows",
        "count": 5
      },
      {
        "op": "index_rows",
        "from": "rows",
        "count": 5,
        "count_key": "top_count",
        "fields": ["line"],
        "prefix_map": {
          "line": "row"
        },
        "fill_empty": true
      }
    ],
    "fields": {
      "count": "top_count"
    }
  },
  "ui": {
    "title": "ADSB Nearest",
    "nodes": [
      {
        "type": "label",
        "x": 6,
        "y": 2,
        "font": 1,
        "color": "#9FD3FF",
        "text": "Nearest ({{count}})"
      },
      {
        "type": "label",
        "x": 6,
        "y": 12,
        "font": 1,
        "color": "#6CA0C8",
        "text": "FLT        DIST    ALT       TYPE->DEST"
      },
      {
        "type": "repeat",
        "count": 5,
        "start": 1,
        "step": 1,
        "var": "i",
        "node": {
          "type": "label",
          "x": 6,
          "y": "24 + (i-1)*18",
          "w": 148,
          "h": 10,
          "wrap": true,
          "max_lines": 1,
          "overflow": "ellipsis",
          "font": 1,
          "color": "#FFFFFF",
          "path": "row{{i}}"
        }
      }
    ]
  }
}
